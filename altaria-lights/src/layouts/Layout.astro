---
import Header from '../components/Header.astro';
import icon from '../assets/logo-morado.png';
---
<!doctype html>
<html lang="es">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link
            rel="shortcut icon"
            href="../assets/logo-morado.png"
            type="image/x-icon"
        />
		<meta name="generator" content={Astro.generator} />
		<link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
        />
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
            rel="stylesheet"
        />
        <link
            rel="shortcut icon"
            href="images/logo-morado.png"
            type="image/x-icon"
        />
        <script
            src="https://unpkg.com/@dotlottie/player-component@2.7.12/dist/dotlottie-player.mjs"
            type="module"
        ></script>
		<title>Altaria Lights | Agencia de Desarrollo y Automatización en Toledo</title>
		<meta name="description" content="Agencia de Desarrollo de Software y Automatización en Toledo" />
	</head>
	<body>
		<Header />
		<slot />
	</body>
	<script is:inline>
		/*HEADER*/

document.addEventListener("DOMContentLoaded", function () {
    const header = document.getElementById("main-header");
    const toggle = document.getElementById("menu-toggle");
    const overlay = document.getElementById("menu-overlay");
    const body = document.body;

    function updateHeaderScrolled() {
        if (overlay.classList.contains("active") || window.scrollY > 0) {
            header.classList.add("scrolled");
        } else {
            header.classList.remove("scrolled");
        }
    }

    window.addEventListener("scroll", updateHeaderScrolled);

    toggle.addEventListener("click", () => {
        toggle.classList.toggle("active");
        overlay.classList.toggle("active");

        if (overlay.classList.contains("active")) {
            body.style.overflow = "hidden";
        } else {
            body.style.overflow = "";
        }

        updateHeaderScrolled(); 
    });

    // Cierra el menú al hacer clic en cualquier enlace
    document.querySelectorAll(".menu-overlay a").forEach((link) =>
        link.addEventListener("click", () => {
            toggle.classList.remove("active");
            overlay.classList.remove("active");
            body.style.overflow = ""; 
            updateHeaderScrolled(); 
        })
    );

    // Estado inicial
    updateHeaderScrolled();
});

/*PORTADA*/

// Create particle effect
const particlesContainer = document.getElementById("particles-container");
const particleCount = 500;

// Create particles
for (let i = 0; i < particleCount; i++) {
    createParticle();
}

function createParticle() {
    const particle = document.createElement("div");
    particle.className = "particle";

    const size = Math.random() * 3 + 1;
    particle.style.width = `${size}px`;
    particle.style.height = `${size}px`;

    resetParticle(particle, true);

    particlesContainer.appendChild(particle);

    animateParticle(particle, true);
}

function resetParticle(particle, initial = false) {
    const posX = Math.random() * 100;
    const posY = Math.random() * 100;

    particle.style.left = `${posX}%`;
    particle.style.top = `${posY}%`;

    if (initial) {
        particle.style.opacity = (Math.random() * 0.3 + 0.1).toString();
    } else {
        particle.style.opacity = "0";
    }

    return { x: posX, y: posY };
}

function animateParticle(particle, firstRun = false) {
    const pos = resetParticle(particle);

    const duration = Math.random() * 10 + 10;
    const delay = firstRun ? 0 : Math.random() * 5;

    setTimeout(() => {
        void particle.offsetWidth;

        particle.style.transition = `all ${duration}s linear`;
        particle.style.opacity = (Math.random() * 0.3 + 0.1).toString();

        const moveX = pos.x + (Math.random() * 20 - 10);
        const moveY = pos.y - Math.random() * 30;

        particle.style.left = `${moveX}%`;
        particle.style.top = `${moveY}%`;

        setTimeout(() => {
            animateParticle(particle);
        }, duration * 1000);
    }, delay * 1000);
}

/* FORMULARIO EVITAR REDIRECCION*/

const form = document.getElementById("contact-form");
const status = document.getElementById("form-status");

form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const data = new FormData(form);

    try {
        const response = await fetch(form.action, {
            method: "POST",
            body: data,
            headers: {
                Accept: "application/json",
            },
        });

        if (response.ok) {
            status.innerText = "¡Mensaje enviado con éxito!";
            form.reset();
        } else {
            status.innerText = "Hubo un problema. Inténtalo más tarde.";
        }
    } catch (error) {
        status.innerText = "Error de red. Inténtalo de nuevo.";
    }
});

	</script>
</html>


